<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<!-- iOS Safari -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<!-- Chrome, Firefox OS and Opera Status Bar Color -->
<meta name="theme-color" content="#FFFFFF">
<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css">
<link rel="stylesheet" type="text/css"
  href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.19.0/themes/prism.min.css">
<link rel="stylesheet" type="text/css" href="css/SourceSansPro.css">
<link rel="stylesheet" type="text/css" href="css/theme.css">
<link rel="stylesheet" type="text/css" href="css/notablog.css">
<!-- Favicon -->

<style>
  :root {
    font-size: 20px;
  }
</style>
  <title>Simple Shellcode Tale!&nbsp;|&nbsp;www.offensivethink.com</title>
  <meta property="og:type" content="blog">
  <meta property="og:title" content="Simple Shellcode Tale!">
  
    <meta name="description" content="Um shellcode simples que n√£o executa. Um c√≥digo C simples e citado em v√°rios exemplos que gera Segmentation Fault. Como tudo pode ser corrigido!">
    <meta property="og:description" content="Um shellcode simples que n√£o executa. Um c√≥digo C simples e citado em v√°rios exemplos que gera Segmentation Fault. Como tudo pode ser corrigido!">
  
  
  <style>
    .DateTagBar {
      margin-top: 1.0rem;
    }
  </style>
</head>

<body>
  <nav class="Navbar">
  <a href="index.html">
    <div class="Navbar__Btn">
      
      <span>Home</span>
    </div>
  </a>
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <span class="Navbar__Delim">&centerdot;</span>
      <a href="referencia-rapida.html">
        <div class="Navbar__Btn">
          
          <span>‚Üí Refer√™ncia r√°pida ‚Üê </span>
        </div>
      </a>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <span class="Navbar__Delim">&centerdot;</span>
      <a href="contacts.html">
        <div class="Navbar__Btn">
          
            <span><img class="inline-img-icon" src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F12e48681-f6a0-41cb-aa1f-73a46f35c5d3%2FOffensiveThink_Logo_Negative_notion_-_280x280.png?table=block&amp;id=ca933149-5245-4511-a885-9cf5922808e1"></span>&nbsp;
          
          <span>about &amp; contacts</span>
        </div>
      </a>
    
  
    
      <span class="Navbar__Delim">&centerdot;</span>
      <a href="offensivetools.html">
        <div class="Navbar__Btn">
          
          <span>Offensive Tools</span>
        </div>
      </a>
    
  
    
  
    
  
</nav>
  <header class="Header">
    
    <div class="Header__Spacer Header__Spacer--NoCover">
    </div>
    
    <h1 class="Header__Title_post">Simple Shellcode Tale!</h1>
    
      <div class="DateTagBar">
        
          <span class="DateTagBar__Item DateTagBar__Date">Posted on Fri, Jun 4, 2021</span>
        
        
          <span class="DateTagBar__Item DateTagBar__Tag DateTagBar__Tag--yellow">
            <a href="tag/osce.html">osce</a>
          </span>
        
          <span class="DateTagBar__Item DateTagBar__Tag DateTagBar__Tag--red">
            <a href="tag/binary-exploitation.html">binary-exploitation</a>
          </span>
        
          <span class="DateTagBar__Item DateTagBar__Tag DateTagBar__Tag--orange">
            <a href="tag/shellcoding.html">shellcoding</a>
          </span>
        
      </div>
    
  </header>
  <article id="https://www.notion.so/a8926e03f50f47728c6a50e9ea680e6c" class="PageRoot"><div id="https://www.notion.so/ae97dd96e9e34bddb68c6bb5c872acdb" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Ambiente no qual o artigo foi baseado!</span></span></p></div><pre id="https://www.notion.so/ca22c02acc2a465ab62027bae693da18" class="Code"><code><span class="SemanticStringArray"><span class="SemanticString"><span>diego<span class="token operator">></span> <span class="token function">uname</span> -a
Linux kali <span class="token number">5.10</span>.0-kali7-amd64 <span class="token comment">#1 SMP Debian 5.10.28-1kali1 (2021-04-12) x86_64 GNU/Linux</span></span></span></span></code></pre><div id="https://www.notion.so/140a44f9cc2641c39cce5b429761a0b8" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><div id="https://www.notion.so/bb029cb192774adb8f9bfd0033dbfecd" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Hoje me peguei em um completo desespero  üòÇ   ao tentar simplesmente executar um shellcode simples ( apenas executar um /bin/sh usando a syscall execve() ) atrav√©s de um c√≥digo em C &quot;simples&quot;. </span></span></p></div><div id="https://www.notion.so/f86d9c1c2d1f430b96496530aeb19ab7" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">A id√©ia era usar o shellcode dispon√≠vel em </span><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="http://shell-storm.org/shellcode/files/shellcode-827.php">http://shell-storm.org/shellcode/files/shellcode-827.php</a></span><span class="SemanticString">, transcrito abaixo:</span></span></p></div><div id="https://www.notion.so/7b3d5573acba4e738df93cea094e0062" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><pre id="https://www.notion.so/ceb818ff70ac417dabeed9655f109655" class="Code"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token comment">/*
    *****************************************************
    *    Linux/x86 execve /bin/sh shellcode 23 bytes    *
    *****************************************************
    *         Author: Hamza Megahed             *
    *****************************************************
    *             Twitter: @Hamza_Mega                  *
    *****************************************************
    *     blog: hamza-mega[dot]blogspot[dot]com         *
    *****************************************************
    *   E-mail: hamza[dot]megahed[at]gmail[dot]com      *
    *****************************************************

xor    %eax,%eax
push   %eax
push   $0x68732f2f
push   $0x6e69622f
mov    %esp,%ebx
push   %eax
push   %ebx
mov    %esp,%ecx
mov    $0xb,%al
int    $0x80
*/</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string.h></span></span>

<span class="token keyword">char</span> <span class="token operator">*</span>shellcode <span class="token operator">=</span> <span class="token string">"\x31\xc0\x50\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69"</span>
          <span class="token string">"\x6e\x89\xe3\x50\x53\x89\xe1\xb0\x0b\xcd\x80"</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stdout</span><span class="token punctuation">,</span><span class="token string">"Length: %d\n"</span><span class="token punctuation">,</span><span class="token function">strlen</span><span class="token punctuation">(</span>shellcode<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> shellcode<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></span></span></span></code></pre><div id="https://www.notion.so/4a4432e2cc5e4d93909ee7524476ae94" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><div id="https://www.notion.so/7e4c714caefa4b99a4247bb89913bcd7" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">O primeiro problema que encontramos foi que o shellcode n√£o era executado de forma alguma, gerando um segmentation fault. Ao analisar no gdb not√°vamos que este segmentation fault surgia logo ap√≥s a primeira instru√ß√£o ser executada. </span></span></p></div><h3 id="https://www.notion.so/1341182f023846ec9ad4da5b1729f7aa" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/1341182f023846ec9ad4da5b1729f7aa"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Segmentation Fault ao executar o shellcode</span></span></h3><div id="https://www.notion.so/3b847936569c47be8e17eeede55186cd" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Compilando o nosso c√≥digo, desabilitando todas as prote√ß√µes (</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">gcc -m32 -fno-stack-protector -zexecstack -Wl,-z,norelro -no-pie shellcode-test.c -o shellcode-test</code></span><span class="SemanticString"> ) e executando obtemos o Segmentation Fault</span></span></p></div><div id="https://www.notion.so/041ee203144346eebdae6ad8619ed919" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F40c6d853-db81-4fc7-aa46-28b61da87128%2FPasted_image_20210605174116.png?width=2030&amp;table=block&amp;id=041ee203-1443-46ee-bdae-6ad8619ed919"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F40c6d853-db81-4fc7-aa46-28b61da87128%2FPasted_image_20210605174116.png?width=2030&amp;table=block&amp;id=041ee203-1443-46ee-bdae-6ad8619ed919" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/846a4806ebe3413cac31314cd20dde3a" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><div id="https://www.notion.so/3277d5f9523d4d7e963a02973144749e" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">O que acontece √© que a regi√£o de mem√≥ria onde o shellcode √© colocado √© marcada s√≥ para leitura e escrita e n√£o para execu√ß√£o. Olhando atentamente o que observamos √© que declaramos uma constante global e n√£o local √† fun√ß√£o main(), logo, ela ser√° armazenada, de acordo com o compilador, em uma regi√£o espec√≠fica. Como trata-se de ponteiro global inicializado o gcc, pelo que vemos, coloca ele na se√ß√£o .rodata. Esta se√ß√£o n√£o tem permiss√£o de execu√ß√£o.</span></span></p></div><div id="https://www.notion.so/5cd72a151e2d42d99e5bdd132df4ca39" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Vamos verificar isso direto no gdb, com o plugin gef j√° instalado, para entendermos melhor.</span></span></p></div><div id="https://www.notion.so/dda80b96813a4a33882cbe0d2b89d117" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Executando o comando </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">gef&gt; disas main</code></span><span class="SemanticString">, observamos onde as nossas fun√ß√µes s√£o chamadas.</span></span></p></div><div id="https://www.notion.so/7f0a94e1af9d4ef7a23297d052a7cd60" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Ff2c61469-2378-4fce-8edf-e603c5d538f3%2FPasted_image_20210605180329.png?width=902&amp;table=block&amp;id=7f0a94e1-af9d-4ef7-a232-97d052a7cd60"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Ff2c61469-2378-4fce-8edf-e603c5d538f3%2FPasted_image_20210605180329.png?width=902&amp;table=block&amp;id=7f0a94e1-af9d-4ef7-a232-97d052a7cd60" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/e7f1e7cd499847caa7acccc4b8db0aa3" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Colocando um breakpoint em </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">0x080491c0 &lt;+78&gt;:    call   eax</code></span><span class="SemanticString"> , usando o comando </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">b *0x080491c0</code></span><span class="SemanticString">, e executando o programa </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">gef&gt; r</code></span><span class="SemanticString">, paramos exatamente na instru√ß√£o que transferir√° o fluxo de execu√ß√£o para o nosso shellcode.</span></span></p></div><div id="https://www.notion.so/91db5cf4bd0f4e6a9755e9b0055b9c3d" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F37e02aae-1768-46f9-aa7c-45624e03e2a1%2FPasted_image_20210605181412.png?width=915&amp;table=block&amp;id=91db5cf4-bd0f-4e6a-9755-e9b0055b9c3d"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F37e02aae-1768-46f9-aa7c-45624e03e2a1%2FPasted_image_20210605181412.png?width=915&amp;table=block&amp;id=91db5cf4-bd0f-4e6a-9755-e9b0055b9c3d" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/ae8d4364407f4b1bbb1837fda20b1ef2" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Colocando um breakpoint no endere√ßo que est√° apontado por eax</span></span></p></div><div id="https://www.notion.so/c86350a89ef54b7680b47aba2a5fb0aa" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F211c60fd-7eac-403b-9e1c-08f1e27e8852%2FPasted_image_20210605181500.png?width=384&amp;table=block&amp;id=c86350a8-9ef5-4b76-80b4-7aba2a5fb0aa"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F211c60fd-7eac-403b-9e1c-08f1e27e8852%2FPasted_image_20210605181500.png?width=384&amp;table=block&amp;id=c86350a8-9ef5-4b76-80b4-7aba2a5fb0aa" style="width:384px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/0bc92b1d0e9242c7be64102c375cc0da" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">e dando continuidade a execu√ß√£o do programa, pararemos na primeira instru√ß√£o do nosso shellcode.</span></span></p></div><div id="https://www.notion.so/10bf1aba133b48dc87eadec7f6b200c6" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F92165d45-9a77-4307-ab2b-bc96ba8748e3%2FPasted_image_20210605183018.png?width=728&amp;table=block&amp;id=10bf1aba-133b-48dc-87ea-dec7f6b200c6"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F92165d45-9a77-4307-ab2b-bc96ba8748e3%2FPasted_image_20210605183018.png?width=728&amp;table=block&amp;id=10bf1aba-133b-48dc-87ea-dec7f6b200c6" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/1173fd2758c345c89cebf06443897e64" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Vamos observar ent√£o, como est√£o as permiss√µes da regi√£o de mem√≥ria onde nosso shellcode foi colocado, ou seja, qa regi√£o de mem√≥ria que cont√©m o endere√ßo </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">0x0804a008</code></span><span class="SemanticString">, utlizando o comando </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">vmmap</code></span><span class="SemanticString">.</span></span></p></div><div id="https://www.notion.so/31a40609319042689d5d5ea96a64f63c" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Ffd046bc9-ea59-4719-9672-c083f32fa2cb%2FPasted_image_20210605183244.png?width=964&amp;table=block&amp;id=31a40609-3190-4268-9d5d-5ea96a64f63c"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Ffd046bc9-ea59-4719-9672-c083f32fa2cb%2FPasted_image_20210605183244.png?width=964&amp;table=block&amp;id=31a40609-3190-4268-9d5d-5ea96a64f63c" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/50808c047206464ba666e79a1995f374" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Observamos ent√£o que nosso shellcode est√° em uma regi√£o de mem√≥ria onde s√≥ √© permitida a leitura e n√£o a execu√ß√£o de c√≥digo.</span></span></p></div><div id="https://www.notion.so/da9e31d9a44445a9ac5f011380abacae" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Se utlizarmos o comando </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">info files</code></span><span class="SemanticString"> podemos observar em que se√ß√£o do bin√°rio ELF nosso shellcode foi colocado pelo compilador:</span></span></p></div><div id="https://www.notion.so/e051122a1ae14ceb8466ee93fcf21760" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fcc95455f-fae2-41b5-bf11-eb9b97502ccc%2FPasted_image_20210605183538.png?width=1121&amp;table=block&amp;id=e051122a-1ae1-4ceb-8466-ee93fcf21760"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fcc95455f-fae2-41b5-bf11-eb9b97502ccc%2FPasted_image_20210605183538.png?width=1121&amp;table=block&amp;id=e051122a-1ae1-4ceb-8466-ee93fcf21760" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/ee70bba5bac94698ab64d60c2d14655b" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Neste caso, na </span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">se√ß√£o .rodata</strong></span><span class="SemanticString">.</span></span></p></div><div id="https://www.notion.so/188b39cf70684e2fabd32dca11f9e3b3" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Do wiki </span><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://wiki.osdev.org/ELF">https://wiki.osdev.org/ELF</a></span><span class="SemanticString"> , temos:</span></span></p></div><blockquote id="https://www.notion.so/ba56a8ca95294427a912e5deef1385da" class="ColorfulBlock ColorfulBlock--ColorDefault Quote"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">.rodata</strong></span><span class="SemanticString"> -&gt; that‚Äôs where your strings go, usually the things you forgot when linking and that cause your kernel not to work. </span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">objdump -s -j .rodata</strong></span><span class="SemanticString"> .process.o will hexdump it. Note that depending on the compiler, you may have more sections like this.</span></span></blockquote><div id="https://www.notion.so/05aaec26f2a641e8965bca8049927fd9" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Usando o objdump, conforme sugerido pelo artigo, podemos confirmar a presen√ßa do nosso shellcode:</span></span></p></div><div id="https://www.notion.so/f30efa93b0484643a9d441ebd89bef0e" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fc937a808-b968-4ff0-a524-3bf72babaf0d%2FPasted_image_20210605183918.png?width=872&amp;table=block&amp;id=f30efa93-b048-4643-a9d4-41ebd89bef0e"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fc937a808-b968-4ff0-a524-3bf72babaf0d%2FPasted_image_20210605183918.png?width=872&amp;table=block&amp;id=f30efa93-b048-4643-a9d4-41ebd89bef0e" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/a288f72bdce94f9bb0b24d0f4c50d5ca" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Logo, estamos realmente desabilitando as prote√ß√µes permitindo que c√≥digos na p√≠lha sejam executados, mas esta a√ß√£o n√£o surte efeito pois o nosso c√≥digo n√£o est√° na pilha.</span></span></p></div><div id="https://www.notion.so/34e83364f9a142fc98c57e39000ec1c4" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">SOLU√á√ÉO 1</strong></span></span></span></p></div><div id="https://www.notion.so/671db50d108a40d093643d51c96e0469" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Para resolver esta situa√ß√£o podemos declarar a nosso vari√°vel como local √† fun√ß√£o main()** e ser do tipo array e n√£o um ponteiro**. Se deixarmos a declara√ß√£o como ponteiro, nosso vari√°vel ainda ser√° colocada em outra se√ß√£o e consequentemente n√£o estar√° na pilha.</span></span></p></div><pre id="https://www.notion.so/9638c9ded0dc4e058577df31786889c2" class="Code"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string.h></span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>

    <span class="token keyword">char</span> shellcode<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"\x31\xc0\x50\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69"</span>
                       <span class="token string">"\x6e\x89\xe3\x50\x53\x89\xe1\xb0\x0b\xcd\x80"</span><span class="token punctuation">;</span>


    <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stdout</span><span class="token punctuation">,</span><span class="token string">"Length: %d\n"</span><span class="token punctuation">,</span><span class="token function">strlen</span><span class="token punctuation">(</span>shellcode<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> shellcode<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
    
<span class="token punctuation">}</span></span></span></span></code></pre><div id="https://www.notion.so/591fe9c9dce2430986e94c660178ff7f" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><div id="https://www.notion.so/35802375a4974ec786ecb5ad274b47bf" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Uma explica√ß√£o do motivo de ser necess√°rio declarar um array e n√£o um ponteiro.</span></span></p></div><blockquote id="https://www.notion.so/5bfe91e532874dde914ba8842001f0ac" class="ColorfulBlock ColorfulBlock--ColorDefault Quote"><span class="SemanticStringArray"><span class="SemanticString">For an example, if two declarations are like char s[20], and char *s respectively, then by using sizeof() we will get 20, and 4. The first one will be 20 as it is showing that there are 20 bytes of data. But second one is showing only 4 as this is the size of one pointer variable. For the array, the total string is stored in the stack section, but for the pointer, the pointer variable is stored into stack section, and content is stored at code section. And the most important difference is that, we cannot edit the pointer type string. So this is read-only. But we can edit array representation of the string ( </span><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://www.tutorialspoint.com/difference-between-char-s-and-char-s-in-c">https://www.tutorialspoint.com/difference-between-char-s-and-char-s-in-c</a></span><span class="SemanticString"> )</span></span></blockquote><div id="https://www.notion.so/14ce864ca8f54416b10819f982c9f178" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><div id="https://www.notion.so/465c984d23304b6181492907a24222b5" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Desta forma, podemos notar, atrav√©s mais uma vez do gdb, que desta vez o EAX apontar√° para um endere√ßo na stack da fun√ß√£o, que agora tem permiss√£o de execu√ß√£o.</span></span></p></div><div id="https://www.notion.so/4400289a89e346dfaae8e0e5e2d58963" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Colocando um breakpoint antes da instru√ß√£o </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">call eax</code></span><span class="SemanticString">, podemos observar que agora, o registrador EAX aponta para uma regi√£o da stack da fun√ß√£o atual ( main() ).</span></span></p></div><div id="https://www.notion.so/7f3124c7430541e0a55cd8b3514de3f8" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F43fe8c6d-2b44-4a17-8d98-ff42f278112c%2FPasted_image_20210605190032.png?width=1281&amp;table=block&amp;id=7f3124c7-4305-41e0-a55c-d8b3514de3f8"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F43fe8c6d-2b44-4a17-8d98-ff42f278112c%2FPasted_image_20210605190032.png?width=1281&amp;table=block&amp;id=7f3124c7-4305-41e0-a55c-d8b3514de3f8" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/a45b29e8d8a44629aa2ec6319e0e78fd" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Confirmamos com o </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">vmmap</code></span><span class="SemanticString"> que nosso shellcode est√° na stack e que ela tem permiss√£o de execu√ß√£o.</span></span></p></div><div id="https://www.notion.so/ac8b555a11e740d7a01005e6aa9bbe9d" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F76dc98f9-3a28-4ae6-89a1-6f15f2257e57%2FPasted_image_20210605190230.png?width=872&amp;table=block&amp;id=ac8b555a-11e7-40d7-a010-05e6aa9bbe9d"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F76dc98f9-3a28-4ae6-89a1-6f15f2257e57%2FPasted_image_20210605190230.png?width=872&amp;table=block&amp;id=ac8b555a-11e7-40d7-a010-05e6aa9bbe9d" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/935c65c247fd4e5296a31291862f4a7c" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">SOLU√á√ÉO 2</strong></span></span></span></p></div><div id="https://www.notion.so/a0576efaac5b4b8d9f001e245d9c690c" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Uma outra forma de contornar essa restri√ß√£o, sem precisar se preocupar em declarar a vair√°vel como um array local e remover as restri√ß√µes √© mapear uma regi√£o de mem√≥ria com as devidas permiss√µes e nesta regi√£o colocar nosso shellcode. O c√≥digo abaixo faz isso.</span></span></p></div><pre id="https://www.notion.so/f49bfe21e8504aaca955fa1d15de8e36" class="Code"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/mman.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;errno.h></span></span>


<span class="token keyword">const</span> <span class="token keyword">char</span> shellcode<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"\x31\xc0\x50\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69"</span>
                       <span class="token string">"\x6e\x89\xe3\x50\x53\x89\xe1\xb0\x0b\xcd\x80"</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Shellcoding lenght: %d\n"</span><span class="token punctuation">,</span> <span class="token function">strlen</span><span class="token punctuation">(</span>shellcode<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">char</span> <span class="token operator">*</span>buf<span class="token punctuation">;</span>
    <span class="token keyword">int</span> prot <span class="token operator">=</span> PROT_READ <span class="token operator">|</span> PROT_WRITE <span class="token operator">|</span> PROT_EXEC<span class="token punctuation">;</span>
    <span class="token keyword">int</span> flags <span class="token operator">=</span> MAP_PRIVATE <span class="token operator">|</span> MAP_ANONYMOUS<span class="token punctuation">;</span>

    buf <span class="token operator">=</span> <span class="token function">mmap</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>shellcode<span class="token punctuation">)</span><span class="token punctuation">,</span> prot<span class="token punctuation">,</span> flags<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">memcpy</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span> shellcode<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>shellcode<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">)</span>buf<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></span></span></span></code></pre><h3 id="https://www.notion.so/b440b2e4604b42fead7f86572c2d44d5" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/b440b2e4604b42fead7f86572c2d44d5"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Shellcode com problema!</span></span></h3><div id="https://www.notion.so/e548c502e42f4285a618e709055e79cf" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Outro problema surgiu foi que, mesmo ap√≥s dadas as solu√ß√µes acima, ao executar o programa este retornava com segmentation fault. Depois de debugar e consultar algumas fontes na internet observamos que o shellcode n√£o zera o registrador EDX antes de chamar a syscall execve e nem t√£o pouco faz a sa√≠da do shellcode de forma correta.</span></span></p></div><div id="https://www.notion.so/692566f9ba1d451db06f3fd0df268302" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Observamos que a execve() requer 3 par√¢metros</span></span></p></div><div id="https://www.notion.so/566bfb5bbe5a4eb48dd589ca4cf5dd04" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F46aed35f-39b1-40f8-ba5d-fedc354a0df0%2FPasted_image_20210605191406.png?width=480&amp;table=block&amp;id=566bfb5b-be5a-4eb4-8dd5-89ca4cf5dd04"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F46aed35f-39b1-40f8-ba5d-fedc354a0df0%2FPasted_image_20210605191406.png?width=480&amp;table=block&amp;id=566bfb5b-be5a-4eb4-8dd5-89ca4cf5dd04" style="width:480px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/65acb52cd64f417cb4a82d2414b295d4" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">E quando estamos trabalhando com syscall linux 32bits devemos passar os par√¢metros atrav√©s dos registradores, da seguinte forma: EAX -&gt; syscall number (11 = 0x0a), EBX -&gt; Param 1 , ECX -&gt; Param 2, EDX -&gt; param3.</span></span></p></div><div id="https://www.notion.so/252d5864aad04572a2f0b08e6d5e901d" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">O que acontece √© que sem tratar o EDX (terceiro par√¢metro) estamos passando ‚Äúlixo‚Äù para a fun√ß√£o execve. Como o terceiro par√¢metro se refere a vari√°veis de ambiente podemos simplesmente zer√°-lo, como se pass√°ssemos nulo para a fun√ß√£o.</span></span></p></div><div id="https://www.notion.so/828d34266b0d45faabe575377b768ea3" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Logo outro shellcode (</span><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="http://shell-storm.org/shellcode/files/shellcode-811.php">http://shell-storm.org/shellcode/files/shellcode-811.php</a></span><span class="SemanticString">), foi utilizado, onde este zera o registrador EDX antes da syscall e tamb√©m executa o exit() ap√≥s o execve.</span></span></p></div><div id="https://www.notion.so/11db5b659f424e36a238d842cc1afeec" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><pre id="https://www.notion.so/34e5257439fe4f7bb3c06416d4a730eb" class="Code"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token comment">/*
Title:  Linux x86 execve("/bin/sh") - 28 bytes
Author: Jean Pascal Pereira &lt;pereira@secbiz.de>
Web:    http://0xffe4.org


Disassembly of section .text:

08048060 &lt;_start>:
 8048060: 31 c0                 xor    %eax,%eax
 8048062: 50                    push   %eax
 8048063: 68 2f 2f 73 68        push   $0x68732f2f
 8048068: 68 2f 62 69 6e        push   $0x6e69622f
 804806d: 89 e3                 mov    %esp,%ebx
 804806f: 89 c1                 mov    %eax,%ecx
 8048071: 89 c2                 mov    %eax,%edx
 8048073: b0 0b                 mov    $0xb,%al
 8048075: cd 80                 int    $0x80
 8048077: 31 c0                 xor    %eax,%eax
 8048079: 40                    inc    %eax
 804807a: cd 80                 int    $0x80



*/</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>

  <span class="token keyword">char</span> shellcode<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"\x31\xc0\x50\x68\x2f\x2f\x73"</span>
                   <span class="token string">"\x68\x68\x2f\x62\x69\x6e\x89"</span>
                   <span class="token string">"\xe3\x89\xc1\x89\xc2\xb0\x0b"</span>
                   <span class="token string">"\xcd\x80\x31\xc0\x40\xcd\x80"</span><span class="token punctuation">;</span>

  <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stdout</span><span class="token punctuation">,</span><span class="token string">"Lenght: %d\n"</span><span class="token punctuation">,</span><span class="token function">strlen</span><span class="token punctuation">(</span>shellcode<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword">void</span>  <span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> shellcode<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></span></span></span></code></pre><div id="https://www.notion.so/6d2c87b0404e404bb8477f9a30f986df" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Usando o nosso c√≥digo, agora com vari√°vel local:</span></span></p></div><pre id="https://www.notion.so/78bebebf9ed64dffa3a0b5716f7bd4ca" class="Code"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string.h></span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>

    <span class="token keyword">char</span> shellcode<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"\x31\xc0\x50\x68\x2f\x2f\x73"</span>
                   <span class="token string">"\x68\x68\x2f\x62\x69\x6e\x89"</span>
                   <span class="token string">"\xe3\x89\xc1\x89\xc2\xb0\x0b"</span>
                   <span class="token string">"\xcd\x80\x31\xc0\x40\xcd\x80"</span><span class="token punctuation">;</span>

    <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stdout</span><span class="token punctuation">,</span><span class="token string">"Length: %d\n"</span><span class="token punctuation">,</span><span class="token function">strlen</span><span class="token punctuation">(</span>shellcode<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> shellcode<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
    
<span class="token punctuation">}</span></span></span></span></code></pre><div id="https://www.notion.so/b0c8156701f049f6bcc8315dbe29f10e" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">ou, usando o mapeamento de mem√≥ria:</span></span></p></div><pre id="https://www.notion.so/bc9355bbfb59492b9f2bd35c89549626" class="Code"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/mman.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;errno.h></span></span>

<span class="token keyword">const</span> <span class="token keyword">char</span> shellcode<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"\x31\xc0\x50\x68\x2f\x2f\x73"</span>
                         <span class="token string">"\x68\x68\x2f\x62\x69\x6e\x89"</span>
                         <span class="token string">"\xe3\x89\xc1\x89\xc2\xb0\x0b"</span>
                         <span class="token string">"\xcd\x80"</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Shellcoding lenght: %d\n"</span><span class="token punctuation">,</span> <span class="token function">strlen</span><span class="token punctuation">(</span>shellcode<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">char</span> <span class="token operator">*</span>buf<span class="token punctuation">;</span>
    <span class="token keyword">int</span> prot <span class="token operator">=</span> PROT_READ <span class="token operator">|</span> PROT_WRITE <span class="token operator">|</span> PROT_EXEC<span class="token punctuation">;</span>
    <span class="token keyword">int</span> flags <span class="token operator">=</span> MAP_PRIVATE <span class="token operator">|</span> MAP_ANONYMOUS<span class="token punctuation">;</span>

    buf <span class="token operator">=</span> <span class="token function">mmap</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>shellcode<span class="token punctuation">)</span><span class="token punctuation">,</span> prot<span class="token punctuation">,</span> flags<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">memcpy</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span> shellcode<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>shellcode<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">)</span>buf<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></span></span></span></code></pre><div id="https://www.notion.so/38345570a9334865b9a51a20c379cdb5" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Conseguimos executar nosso shellcode, como esperado:</span></span></p></div><div id="https://www.notion.so/a108fd848f7349f9b661d6a269cbf146" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fa2f2308d-f34d-4613-9445-d6a99d1169aa%2FPasted_image_20210605192349.png?width=1916&amp;table=block&amp;id=a108fd84-8f73-49f9-b661-d6a269cbf146"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fa2f2308d-f34d-4613-9445-d6a99d1169aa%2FPasted_image_20210605192349.png?width=1916&amp;table=block&amp;id=a108fd84-8f73-49f9-b661-d6a269cbf146" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><h3 id="https://www.notion.so/5a6d20c40a1340c6aaf3b81ad675a4c6" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/5a6d20c40a1340c6aaf3b81ad675a4c6"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Refer√™ncias Utilizadas para entender o problema</span></span></h3><ul class="BulletedListWrapper"><li id="https://www.notion.so/e7f3ba52bada4da1b053b7ced40c4882" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://stackoverflow.com/questions/19532356/segmentation-fault-when-testing-shellcode">https://stackoverflow.com/questions/19532356/segmentation-fault-when-testing-shellcode</a></span><span class="SemanticString"> ‚Üí o usu√°rio josh5stone , mostra qual o c√≥digo deve ser utilizado para mapear a regi√£o de mem√≥ria e aborda a quest√£o de que exemplos antigos n√£o levam em considera√ß√£o as prote√ß√µes atuais. </span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">O que fiquei na d√∫vida ainda</strong></span><span class="SemanticString"> √© porque mesmo desabilitando as prote√ß√µes no gcc, conforme ele inclusive diz que √© uma solu√ß√£o, ainda assim n√£o funciona.</span></span></li><li id="https://www.notion.so/b527831bea6241779ea82e6402937ba9" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://stackoverflow.com/questions/39737813/disabling-stack-protection-in-gcc-not-working/39738016">https://stackoverflow.com/questions/39737813/disabling-stack-protection-in-gcc-not-working/39738016</a></span><span class="SemanticString"> ‚Üí Neste post tem uma poss√≠vel explica√ß√£o onde um dos usu√°rios coloca que o sistema operacional tomapara si a prote√ß√£o contra o buffer overflow. Poder√≠amos usar o binp√°rio execstack para for√ßar a execu√ß√£o do programa, mas n√£o encontrei instalado e nem pacotes para instalar no kali.</span></span></li><li id="https://www.notion.so/5e08c29aa7944ba7881e58fa7b04a7d3" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://security.stackexchange.com/questions/191384/why-does-my-x86-shellcode-test-program-segfault">https://security.stackexchange.com/questions/191384/why-does-my-x86-shellcode-test-program-segfault</a></span><span class="SemanticString"> ‚Üí O usu√°rio Mr.¬†E , fala sobre algumas quest√µes que foram abordadas erradamente no shellcode do usu√°rio que postou a quest√£o e explicando como a execve deve ser chamada, mostra que falta zerar o edx.1 ntation-fault-when-executing-shellcode</span></span></li></ul><div id="https://www.notion.so/36f2a3a010264067946cf5a36baa9b28" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><h3 id="https://www.notion.so/9e560ac568664b369e32b11a0efc977f" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/9e560ac568664b369e32b11a0efc977f"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Agradecimentos</span></span></h3><div id="https://www.notion.so/8b626cd9bb6b4756a9b2e425cf34babc" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Gostaria de agradecer ao H√©lvio (</span><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://sec4us.com.br/">https://sec4us.com.br/</a></span><span class="SemanticString">) e ao Fabiano Furtado (</span><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://www.linkedin.com/in/fabianofurtado/">https://www.linkedin.com/in/fabianofurtado/</a></span><span class="SemanticString">)  que me ajudaram no entendimento do problema. </span></span></p></div><div id="https://www.notion.so/6d28207b9fde40b884e3e39da3d0306d" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div></article>
  <footer class="Footer">
<script src="https://giscus.app/client.js"
        data-repo="diegoalbuquerque/offensivethinkcomments"
        data-repo-id="R_kgDOJpiCVg"
        data-category="General"
        data-category-id="DIC_kwDOJpiCVs4CW4pD"
        data-mapping="pathname"
        data-strict="0"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="bottom"
        data-theme="dark"
        data-lang="pt"
        crossorigin="anonymous"
        async>
</script>
<br/>
  <div>&copy; www.offensivethink.com 2019-2021</div>
  <div>&centerdot;</div>
  <div>Powered by <a href="https://github.com/dragonman225/notablog" target="_blank"
      rel="noopener noreferrer">Notablog</a>.
  </div>
</footer>
</body>

</html>